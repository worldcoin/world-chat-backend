# cargo-deny configuration
# Based on https://github.com/worldcoin/bedrock/blob/main/deny.toml

[graph]
# Check all features
all-features = true
# Set targets to avoid some cross-compilation issues
targets = ["x86_64-unknown-linux-gnu"]

[sources]
# Deny crates from unknown registries
unknown-registry = "deny"

[bans]
# Allow multiple versions of these crates - they're commonly duplicated in the ecosystem
multiple-versions = "allow"
deny = [
    # forbid OpenSSL and related crates
    { name = "openssl" },
    { name = "openssl-sys" },
    { name = "openssl-src" },
]

[licenses]
version = 2
confidence-threshold = 1.0

# List of allowed licenses
allow = [
    "Apache-2.0",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "BSL-1.0",
    "CC0-1.0",
    "CDLA-Permissive-2.0",
    "ISC",
    "MIT",
    "OpenSSL",
    "Unicode-3.0",
    "Unlicense",
    "Zlib",
]

# Specific exceptions for crates we can't avoid
exceptions = [
    # webpki-roots v0.25.4 is a build dependency of semaphore-rs
    # It won't be included in the final binary, only used during compilation
    { allow = ["MPL-2.0"], name = "webpki-roots", version = "0.25.4" },
]

# Ignore unmaintained required crates warning
[advisories]
ignore = [
    "RUSTSEC-2024-0388",  # Unmaintained `derivative` (2024-11-22)
    "RUSTSEC-2024-0436", # Unmaintained `paste` (2025-04-04)
    "RUSTSEC-2025-0055", # Unmaintained peer dependency of `semaphore-rs` with minimal impact
    "RUSTSEC-2021-0127", # serde_cbor is unmaintained. We use this in AWS NSM package but just for the AttestationDocument Type
]
